pipeline {
    agent any
    
    environment {
        VERSION = '0.1.0'
        RELEASE_VERSION = 'R.2'
    }

    stages {
        stage('Audit tools') {
            steps {
                script {
                    if (isUnix()) {
                        sh '''
                            git version
                            java -version
                            mvn -version
                        '''
                    } else {
                        bat '''
                            git version
                            java -version
                            mvn -version
                        '''
                    }
                }
            }
        }

        stage('Unit Test') {
            steps {
                script {
                    if (isUnix()) {
                        dir('./java-tomcat-sample') {
                            sh '''
                                echo "Executing Unit Tests..."
                                mvn test
                            '''
                        }
                    } else {
                        dir('./java-tomcat-sample') {
                            bat '''
                                echo "Executing Unit Tests..."
                                mvn test
                            '''
                        }
                    }
                }
            }
        }

        stage('Build') {
            steps {
                script {
                    echo "Building version: ${VERSION} with suffix: ${RELEASE_VERSION}"
                    echo 'Mention your Application Build Code here!!!'
                    
                    if (isUnix()) {
                        sh 'mvn -f java-tomcat-sample/pom.xml clean package'
                    } else {
                        bat 'mvn -f java-tomcat-sample/pom.xml clean package'
                    }
                }
            }
        }
    }
}
