pipeline {
    agent any
    
    environment {
      VERSION = '0.1.0'
      RELEASE_VERSION = 'R.2'
    }

    stages {
      stage('Audit tools') {
        steps {
            script {
                if (isUnix()) {
                    sh '''
                        java -version
                        mvn -version
                    '''
                    sh 'printenv'
                    sh 'ls -l $WORKSPACE'
                } else {
                    bat '''
                        java -version
                        mvn -version
                    '''
                    bat 'set'
                    bat 'dir /B %WORKSPACE%'
                }
            }
        }
      }

      stage('Unit Test') {
        steps {
          dir('./java-tomcat-sample') {
            script {
                if (isUnix()) {
                    sh '''
                        echo "Executing Unit Tests..."
                        mvn test
                    '''
                } else {
                    bat '''
                        echo "Executing Unit Tests..."
                        mvn test
                    '''
                }
            }
          }
        }
      }

      stage('Build') {
        steps {
          echo "Building version: ${VERSION} with suffix: ${RELEASE_VERSION}"
          echo 'Mention your Application Build Code here!!!'
          script {
              if (isUnix()) {
                  sh 'mvn -f java-tomcat-sample/pom.xml clean package'
              } else {
                  bat 'mvn -f java-tomcat-sample/pom.xml clean package'
              }
          }
        }
      }
    }
}

/*
Requirements -- 

For Linux/Unix:
1. Jenkins Docker PlugIns
    - Docker
    - Docker Pipeline

2. Install Docker Engine on Execution machine
   Link -- https://docs.docker.com/engine/install/

3. Add Jenkins User to Group
   sudo usermod -a -G docker jenkins

4. Reboot your Machine
   reboot

5. Execute Docker using root User-
   args '-u root'

For Windows:
1. Jenkins Docker PlugIns
    - Docker
    - Docker Pipeline

2. Install Docker Desktop on Windows machine
   Link -- https://docs.docker.com/desktop/install/windows-install/

3. Ensure Docker Desktop is running and configured

4. Jenkins service must have permissions to access Docker

Note: The original Docker agent configuration has been removed to make it cross-platform.
If you want to use Docker on specific platforms, you can use conditional agents:
 
agent {
    node {
        label isUnix() ? 'linux-docker-node' : 'windows-node'
    }
}
*/
